import time

import allure

from base_page.base_page import BasePage
from base_page.base_page_locators import BaseOpenLocators
from open_pages.changing_of_dates.changing_of_dates_locators import ChangeOfDatesLocators
from open_pages.order_details_page.order_details_page_locators import OrderDetailsLocators


@allure.feature('Страница Изменение сроков поставки')
class ChangeOfDatesPage(BasePage):
    """Страница Изменение сроков поставки"""

    def change_interval_days(self):
        """Изменить интервал дней на 3"""
        with allure.step('Изменить интервал дней на 3'):
            self.expecting_clickability(ChangeOfDatesLocators.LOCATOR_BUTTON_FIND)
            btn_choose_interval = self.find_element(ChangeOfDatesLocators.LOCATOR_BUTTON_FOR_INTERVAL_DROP_OUT_LIST)
            btn_choose_interval.click()
            self.waiting_element_is_visibility_on_the_page(ChangeOfDatesLocators.LOCATOR_CHOOSE_THREE_DAYS)
            time.sleep(1)
            choose_three_days = self.find_element(ChangeOfDatesLocators.LOCATOR_CHOOSE_THREE_DAYS)
            choose_three_days.click()
            time.sleep(1)

    def click_btn_find(self):
        """Нажать на кнопку Найти"""
        with allure.step('Нажать на кнопку Найти'):
            btn_find = self.find_element(ChangeOfDatesLocators.LOCATOR_BUTTON_FIND)
            btn_find.click()
            self.waiting_for_loader_processing_on_page(BaseOpenLocators.LOCATOR_SPINNER_NO_TEXT)
            self.waiting_element_is_visibility_on_the_page(ChangeOfDatesLocators.LOCATOR_FIRST_HISTORY)

    def click_history(self):
        """Нажать на историю у первого заказа"""
        with allure.step('Нажать на историю у первого заказа'):
            btn_history = self.find_element(ChangeOfDatesLocators.LOCATOR_FIRST_HISTORY)
            btn_history.click()
            self.waiting_element_is_visibility_on_the_page(ChangeOfDatesLocators.LOCATOR_HEADER_WINDOW_DETAIL_HISTORY)

            self.waiting_for_loader_processing_on_page(BaseOpenLocators.LOCATOR_SPINNER_NO_TEXT)
            btn_close = self.find_element(ChangeOfDatesLocators.LOCATOR_WINDOW_DETAIL_HISTORY_CLOSE)
            self.driver.execute_script("arguments[0].click()", btn_close)
            self.waiting_for_loader_processing_on_page(BaseOpenLocators.LOCATOR_SPINNER_NO_TEXT)

    def click_more_detail(self):
        """Нажать на кнопку Подробнее"""
        with allure.step('Нажать на кнопку Подробнее'):
            btn_more_detail = self.find_element(ChangeOfDatesLocators.LOCATOR_MORE_DETAILS)
            btn_more_detail.click()
            self.switching_window(-1)
            self.waiting_for_loader_processing_on_page(BaseOpenLocators.LOCATOR_SPINNER_NO_TEXT)
            self.waiting_element_is_visibility_on_the_page(OrderDetailsLocators.LOCATOR_CONTRACT_NUMBER)

    def store_num_order(self) -> str:
        """Сохранение номера заказа"""
        with allure.step('Сохранение номера заказа'):
            num_order = self.find_element(ChangeOfDatesLocators.LOCATOR_NUMBER_PQ).text
            num_order = num_order.split(' ')[1]
            print(num_order)
            return num_order
