import time

import allure
from selenium.webdriver.support.select import Select

from base_page.base_page import BasePage
from open_pages.objects_page.free_jbjects.locators_free_objects import FreeObjectsLocators


@allure.feature('Страница Свободные объекты')
class FreeObjectsPage(BasePage):
    """Страница Свободные объекты"""

    def click_button_search(self):
        """Клик по кнопке Найти"""
        with allure.step('Клик по кнопке Найти Свободный объект'):
            button_search = self.find_element(FreeObjectsLocators.LOCATOR_BUTTON_SEARCH)
            self.driver.execute_script("arguments[0].click()", button_search)
            time.sleep(0.5)
            self.waiting_for_loader_processing_in_dom(FreeObjectsLocators.LOADER_OLD_FREE_OBJECTS)

    def go_to_first_object(self):
        """Переход в 1-ый объект на странице"""
        with allure.step('Переход в 1-ый объект на странице в Свободный объект'):
            self.waiting_element_is_visibility_on_the_page(FreeObjectsLocators.LOCATOR_NUM_OBJECTS, sec=90)
            list_objects = self.driver.find_elements(*FreeObjectsLocators.LOCATOR_NUM_OBJECTS)
            self.driver.execute_script("arguments[0].click()", list_objects[0])
            self.switching_window(-1)
            self.is_element_present(*FreeObjectsLocators.LOCATOR_H1_HEADER_OBJECT)

    def choice_inn(self, inn: str):
        """Выбор ИНН"""
        with allure.step('Выбор ИНН в Свободный объект'):
            select_inn = self.find_element(FreeObjectsLocators.LOCATOR_SELECT_INN)
            select = Select(select_inn)
            select.select_by_value(inn)
