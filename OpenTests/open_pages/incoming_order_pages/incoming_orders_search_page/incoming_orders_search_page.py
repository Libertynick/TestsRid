import time

import allure

from base_page.base_page import BasePage
from open_pages.incoming_order_pages.incoming_order_page.incoming_order_page_locators import IncomingOrderPageLocators
from open_pages.incoming_order_pages.incoming_orders_search_page.incoming_orders_search_page_locators import \
    IncomingOrdersSearchPageLocators


class IncomingOrdersSearchPage(BasePage):
    """Страница Поиска Входящие заказы"""

    def click_advanced_search(self):
        """Клик по кнопке Расширенный поиск"""
        with allure.step('Клик по кнопке Расширенный поиск'):
            button_advanced_search = self.find_element(IncomingOrdersSearchPageLocators.LOCATOR_ADVANCED_SEARCH)
            button_advanced_search.click()
            self.waiting_element_is_visibility_located_dom(IncomingOrdersSearchPageLocators.LOCATOR_FORM_ADVANCED_SEARCH)

    def entry_of_the_order_number_in_the_field(self, num_application: str):
        """Ввод номера заявки в поле ввода Клиент/Адрес/Номер заявки
        num_application - номер заявки
        """
        with allure.step('Ввод номера заявки в поле ввода Клиент/Адрес/Номер заявки'):
            input_field = self.find_element(IncomingOrdersSearchPageLocators.LOCATOR_INPUT_CLIENT_ADDRESS_NUM_APPLICATION)
            input_field.send_keys(num_application)
            selected_value = input_field.get_attribute("value")
            print(selected_value, 'selected_value')
            assert selected_value == num_application, f'Введенное значение номера заявки - ({num_application}) ' \
                                                      f'не отображается в поле ввода - ({selected_value})'

    def search_application(self, num_application: str):
        """Поиск заявки
        num_application - номер заявки
        """
        with allure.step('Поиск заявки'):
            locator_application_link = IncomingOrdersSearchPageLocators.dynamic_application_link_locator(num_application)

            self.click_advanced_search()
            self.entry_of_the_order_number_in_the_field(num_application)
            button_search = self.find_element(IncomingOrdersSearchPageLocators.LOCATOR_BUTTON_SEARCH)
            self.click_js(button_search)
            time.sleep(0.5)
            self.waiting_element_is_visibility_located_dom(IncomingOrdersSearchPageLocators.LOCATOR_BODY_PAGE, sec=40)
            time.sleep(0.5)
            self.waiting_element_is_visibility_on_the_page(locator_application_link)
            link_application = self.find_element(locator_application_link)
            self.click_js(link_application)
            self.waiting_element_is_visibility_located_dom(IncomingOrderPageLocators.LOCATOR_BODY_PAGE, sec=50)
