import time

import allure

from base_page.base_page import BasePage
from base_page.base_page_locators import BaseOpenLocators
from open_pages.cart_page.cart_locators import CartLocators
from open_pages.selection_online_tools_all.heat_select_selection.heat_select_locators import HeatSelectLocators


@allure.feature('Страница подбора Регулирующего клапана')
class HeatSelectPage(BasePage):
    """Страница подбора Регулирующего клапана"""

    def btn_next_step(self):
        """Нажать на кнопку Следующий шаг"""
        with allure.step('Нажать на кнопку Следующий шаг'):
            self.expecting_clickability(HeatSelectLocators.LOCATOR_BTN_NEXT_STEP)
            btn_next_step = self.find_element(HeatSelectLocators.LOCATOR_BTN_NEXT_STEP)
            btn_next_step.click()
            self.waiting_element_is_visibility_on_the_page(HeatSelectLocators.LOCATOR_HEADER_VALVE_DESIGN_PARAMETERS)

    def click_check_box_system_flow(self):
        """Нажать на чек-бокс Расход на систему"""
        with allure.step('Нажать на чек-бокс Расход на систему'):
            check_box_system_flow_off = self.waiting_element_is_visibility_located_dom(
                HeatSelectLocators.LOCATOR_CHECK_BOX_SYSTEM_FLOW_OFF)
            self.driver.execute_script("arguments[0].click()", check_box_system_flow_off)
            self.waiting_element_is_visibility_on_the_page(HeatSelectLocators.LOCATOR_UNIT_SYSTEM_CONSUMPTION)

    def click_btn_select_a_control_valve(self):
        """Нажать на кнопку Подобрать регулирующий клапан"""
        with allure.step('Нажать на кнопку Подобрать регулирующий клапан'):
            btn_select_a_control_valve = self.waiting_element_is_visibility_on_the_page(
                HeatSelectLocators.LOCATOR_BTN_SELECT_A_CONTROL_VALVE)
            btn_select_a_control_valve.click()
            self.expecting_clickability(HeatSelectLocators.LOCATOR_BTN_PERFORM_FIRST_CODE)
            code_found = self.find_element(HeatSelectLocators.LOCATOR_FIRST_CODE_IN_TABLE).text
            return code_found

    def click_btn_perform_first_code(self):
        """Нажать на кнопку перейти у первого кода"""
        with allure.step('Нажать на кнопку перейти у первого кода'):
            btn_perform_first_code = self.find_element(HeatSelectLocators.LOCATOR_BTN_PERFORM_FIRST_CODE)
            self.driver.execute_script("arguments[0].click()", btn_perform_first_code)
            self.expecting_clickability(HeatSelectLocators.LOCATOR_BTN_DOWNLOAD_DOCUMENT)

    def click_btn_download_document(self):
        """Нажать на кнопку скачать документы"""
        with allure.step('Нажать на кнопку скачать документы'):
            # downloads_path = str(Path.home() / "Downloads")
            name_file = 'PDF HeatSel.pdf'  # expect

            self.delete_file_by_name_in_download_folder(name_file)
            btn_download_document = self.find_element(HeatSelectLocators.LOCATOR_BTN_DOWNLOAD_DOCUMENT)
            btn_download_document.click()
            self.checking_the_download_document_in_the_download_folder(name_file)
            self.delete_file_by_name_in_download_folder(name_file)

    def click_btn_add_sales(self):
        """Нажать на кнопку Добавить в Корзину"""
        with allure.step('Нажать на кнопку Добавить в Корзину'):
            btn_add_sales = self.find_element(HeatSelectLocators.LOCATOR_BTN_ADD_TO_CART)
            self.driver.execute_script("arguments[0].click()", btn_add_sales)
            time.sleep(1)
            self.switching_window(-1)
            self.waiting_for_loader_processing_on_page(BaseOpenLocators.LOCATOR_SPINNER_NO_TEXT)
            self.waiting_element_is_visibility_on_the_page(CartLocators.LOCATOR_HEADER_SHARED_YOUR_CART_WITH_YOU)

    def click_btn_direct_regulator(self):
        """Нажать на Регулятор прямого действия"""
        with allure.step('Нажать на Регулятор прямого действия'):
            btn_direct_regulator = self.find_element(HeatSelectLocators.LOCATOR_HEADER_SELECT_DIRECT_REGULATOR)
            self.driver.execute_script("arguments[0].click()", btn_direct_regulator)
            self.waiting_element_is_visibility_on_the_page(HeatSelectLocators.LOCATOR_CHECK_BOX_AFD_VALVE_ON)

    def click_btn_select_a_direct_regulator(self):
        """Нажать на кнопку Подобрать регулирующий клапан"""
        with allure.step('Нажать на кнопку Подобрать регулирующий клапан'):
            btn_select_a_control_valve = self.waiting_element_is_visibility_on_the_page(
                HeatSelectLocators.LOCATOR_BTN_SELECT_A_DIRECT_REGULATOR)
            btn_select_a_control_valve.click()
            self.expecting_clickability(HeatSelectLocators.LOCATOR_BTN_PERFORM_FIRST_CODE, sec=50)
            code_found = self.find_element(HeatSelectLocators.LOCATOR_FIRST_CODE_IN_TABLE).text
            return code_found
