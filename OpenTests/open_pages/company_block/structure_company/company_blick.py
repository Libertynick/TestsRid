import allure

from base_page.base_page import BasePage
from base_page.base_page_locators import BaseOpenLocators
from open_pages.company_block.structure_company.company_block_locators import QueueForConfirmationToCompanyLocators, \
    ActiveUsersLocators


@allure.feature('Блок Компания')
class CompanyBlock(BasePage):
    """Блок Компания"""


@allure.feature('Страница Очередь на подтверждение')
class QueueForConfirmationToCompany(CompanyBlock):
    """Страница Очередь на подтверждение"""

    def click_btn_confirmation_queue(self):
        """Клик по кнопке Очередь на подтверждение"""
        with allure.step('Клик по кнопке Очередь на подтверждение'):
            self.expecting_clickability(QueueForConfirmationToCompanyLocators.LOCATOR_CONFIRMATION_QUEUE)
            btn_confirmation_queue = self.find_element(QueueForConfirmationToCompanyLocators.LOCATOR_CONFIRMATION_QUEUE)
            btn_confirmation_queue.click()
            self.waiting_element_is_visibility_located_dom(
                QueueForConfirmationToCompanyLocators.LOCATOR_BODY_CONFIRMATION_QUEUE, sec=30)

    def should_be_lin_on_e_mail(self, e_mail: str):
        """Должна быть ссылка на эмэйл"""
        with allure.step('Проверка что есть ссылка на email'):
            self.waiting_element_is_visibility_on_the_page(
                QueueForConfirmationToCompanyLocators.locator_link_e_mail(e_mail), sec=10)

    def click_on_button_to_approve_by_e_mail(self, e_mail: str):
        """Клик по кнопке одобрить по e-mail"""
        with allure.step('Клик по кнопке одобрить email'):
            self.waiting_element_is_visibility_located_dom(
                QueueForConfirmationToCompanyLocators.locator_btn_approve_by_e_mail(e_mail))
            btn_approve = self.find_element(QueueForConfirmationToCompanyLocators.locator_btn_approve_by_e_mail(e_mail))
            self.scroll_to(btn_approve)
            self.expecting_clickability(QueueForConfirmationToCompanyLocators.locator_btn_approve_by_e_mail(e_mail))
            self.click_js(btn_approve)
            self.waiting_element_invisibility(
                QueueForConfirmationToCompanyLocators.locator_btn_approve_by_e_mail(e_mail))

    def go_to_active_users_page(self):
        """Переход на страницу Активные пользователи"""
        with allure.step('Переход на страницу Активные пользователи'):
            self.expecting_clickability(QueueForConfirmationToCompanyLocators.LOCATOR_BTN_ACTIVE_USERS)
            btn_active_users = self.find_element(QueueForConfirmationToCompanyLocators.LOCATOR_BTN_ACTIVE_USERS)
            self.scroll_to_height()
            btn_active_users.click()
            self.waiting_for_loader_processing_on_page(BaseOpenLocators.LOCATOR_SPINNER_NO_TEXT)
            self.waiting_element_is_visibility_located_dom(ActiveUsersLocators.LOCATOR_SELECTED_BTN_ACTIVE_USERS)


@allure.feature('Страница Активные пользователи')
class ActiveUsersPage(CompanyBlock):
    """Страница Активные пользователи"""

    def checking_display_of_a_record_from_e_mail(self, e_mail: str):
        """Проверка отображения записи с мэйл ящиком"""
        with allure.step('Проверка отображения записи с мэйл ящиком'):
            self.waiting_element_is_visibility_located_dom(ActiveUsersLocators.locator_column_with_e_mail(e_mail),
                                                           sec=5)
            e_mail_on_page = self.find_element(ActiveUsersLocators.locator_column_with_e_mail(e_mail)).text
            assert e_mail_on_page == e_mail, \
                f'Электронный ящик на странице - ({e_mail_on_page}) не соответствует ожидаемому - ({e_mail})'
