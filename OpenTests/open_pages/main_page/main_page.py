import allure

from base_page.base_page import BasePage
import time

from base_page.base_page_locators import BaseOpenLocators
from open_pages.header.header_locators import HeaderLocators
from open_pages.main_page.main_page_locators import MainPageLocators, AuthorizationModalLocators
from open_pages.registration_page.registration_page_locators import RegistrationPageLocators


@allure.feature('Главная страница')
class MainPage(BasePage):
    """Главная страница"""

    def authorization_from_main_page(self, email, password):
        """Авторизация с главной страницы"""
        with allure.step('Авторизация с главной страницы'):
            with allure.step('Клик по кнопке Войти'):
                time.sleep(1)
                self.waiting_element_is_visibility_on_the_page(HeaderLocators.LOCATOR_TO_COME_IN_BUTTON, sec=30)
                button_come_in = self.find_element(HeaderLocators.LOCATOR_TO_COME_IN_BUTTON)
                button_come_in.click()
                self.find_element(AuthorizationModalLocators.LOCATOR_HEADING)
            with allure.step('Ввод мэйла'):
                self.expecting_clickability(AuthorizationModalLocators.LOCATOR_INPUT_EMAIL, sec=5)
                input_email = self.find_element(AuthorizationModalLocators.LOCATOR_INPUT_EMAIL)
                input_email.send_keys(email)
            with allure.step('Ввод пароля'):
                self.expecting_clickability(AuthorizationModalLocators.LOCATOR_INPUT_PASSWORD, sec=5)
                input_password = self.find_element(AuthorizationModalLocators.LOCATOR_INPUT_PASSWORD)
                input_password.send_keys(password)
            with allure.step('Клик по кнопке Войти в модалке авторизации'):
                button_in = self.find_element(AuthorizationModalLocators.LOCATOR_BUTTON_IN)
                button_in.click()
                with allure.step('Ожидание отработки лоадера после авторизации'):
                    self.waiting_for_loader_processing_in_dom(MainPageLocators.LOCATOR_BTN_LOADER)
                    self.waiting_element_invisibility(HeaderLocators.LOCATOR_TO_COME_IN_BUTTON)
                    self.waiting_for_loader_processing_on_page(BaseOpenLocators.LOCATOR_SPINNER_NO_TEXT, sec=30)


@allure.feature('Модалка Авторизация')
class AuthorizationModal(BasePage):
    """Модалка Авторизация"""

    def click_btn_registration(self):
        """Клик по кнопке Регистрация"""
        with allure.step('Клик по кнопке Регистрация'):
            self.expecting_clickability(AuthorizationModalLocators.LOCATOR_BTN_REGISTRATION)
            btn_registration = self.find_element(AuthorizationModalLocators.LOCATOR_BTN_REGISTRATION)
            btn_registration.click()
            time.sleep(2)
            self.waiting_for_loader_processing_on_page(BaseOpenLocators.LOCATOR_SPINNER_NO_TEXT)
            self.waiting_element_is_visibility_on_the_page(RegistrationPageLocators.LOCATOR_HEADER_REGISTRATION)
