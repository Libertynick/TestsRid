import time

import allure

from base_page.base_page import BasePage
from crm_pages.edit_object_header.edit_object_header_locators import EditPageObject, EditAdressInput
from crm_pages.object_page.objects_page_locators import ObjectsPageLocators


@allure.feature('Шапка объекта')
class EditPageObjectPage(BasePage):
    """Шапка объекта"""

    def input_name_object(self, name, dataname):
        """Заполнение поля имени объекта"""
        with allure.step(f'Заполнение имени объекта'):
            name_object = f'{name}{dataname}'
            self.waiting_element_is_visibility_on_the_page(EditPageObject.LOCATOR_INPUT_NAME_OBJECT)
            input_name_object = self.find_element(EditPageObject.LOCATOR_INPUT_NAME_OBJECT)
            with allure.step(f'Клие по полю ввода имени объекта'):
                input_name_object.click()
                time.sleep(1)
                with allure.step(f'Заполнение поля имени объекта'):
                    input_name_object.send_keys(name, dataname)
                    entered_name_object = input_name_object.get_attribute('value')
                    assert entered_name_object == name_object, \
                        f'Введеное имя объекта - ({entered_name_object}) не соответствует ожидаемому - ({name_object})'

    def indicate_the_address_of_object(self):
        """Кнопка Укажите адрес объекта (открытие модалки для ввода)"""
        with allure.step(f'Нажать на кнопку Укажите адрес объекта (открытие модалки для заполнения адреса)'):
            button_indicate_the_address = self.find_element(EditPageObject.LOCATOR_BUTTON_ADDRESS_OBJECT)
            self.driver.execute_script("arguments[0].click()", button_indicate_the_address)
            self.waiting_element_is_visibility_on_the_page(EditAdressInput.LOCATOR_ADDRESS_INPUT)

    def input_project_adress(self, adress):
        """Ввод проектного адреса"""
        with allure.step(f'Ввод проектного адреса в поле ввода'):
            project_adress = self.find_element(EditPageObject.LOCATOR_ENTRY_FIELD_PROJECT_ADDRESS)
            project_adress.click()
            time.sleep(1)
            project_adress.send_keys(adress)

    def input_name_manager(self, input_name_manager):
        """Выбор менеджера объекта"""
        with allure.step(f'Выбор менеджера объекта'):
            with allure.step(f'Клик по полю для выбора менеджера'):
                name_manager = self.find_element(EditPageObject.LOCATOR_ENTRY_FIELD_NAME_MANAGER)
                name_manager.click()
                with allure.step(f'Ввод имени менеджера'):
                    self.waiting_element_is_visibility_on_the_page(EditPageObject.LOCATOR_INPUT_NAME_MANAGER)
                    name_manager_input = self.find_element(EditPageObject.LOCATOR_INPUT_NAME_MANAGER)
                    name_manager_input.click()
                    time.sleep(1)
                    name_manager_input.send_keys(input_name_manager)
                    with allure.step(f'Выбор найденного менеджера'):
                        self.waiting_element_is_visibility_on_the_page(EditPageObject.LOCATOR_CHOOSE_NAME_MANAGER)
                        choose_name = self.find_element(EditPageObject.LOCATOR_CHOOSE_NAME_MANAGER)
                        choose_name.click()

    def input_project_team(self):
        """Выбор проектной группы"""
        with allure.step(f'Выбор проектной группы на странице редактирования объекта'):
            project_team = self.find_element(EditPageObject.LOCATOR_PROJECT_TEAM)
            project_team.click()
            self.waiting_element_is_visibility_on_the_page(EditPageObject.LOCATOR_CHOOSE_PROJECT_TEAM)
            choose_project_team = self.find_element(EditPageObject.LOCATOR_CHOOSE_PROJECT_TEAM)
            choose_project_team.click()

    def selection_of_engineer_project_team(self, name_designer):
        """Выбор инженера проектной группы"""
        with allure.step(f'Выбор инженера проектной группы'):
            with allure.step(f'Клик по полю для выбора инженера проеткной группы'):
                selection_of_engineer = self.find_element(EditPageObject.LOCATOR_SELECTION_OF_ENGINEER_PROJECT_TEAM)
                selection_of_engineer.click()
                with allure.step(f'Ввод имени инженера проектной группы'):
                    self.waiting_element_is_visibility_on_the_page(
                        EditPageObject.LOCATOR_INPUT_OF_ENGINEER_PROJECT_TEAM)
                    input_engineer_project = self.find_element(EditPageObject.LOCATOR_INPUT_OF_ENGINEER_PROJECT_TEAM)
                    input_engineer_project.click()
                    time.sleep(1)
                    input_engineer_project.send_keys(name_designer)
                    with allure.step(f'Выбор найденного инженера проектной группы'):
                        self.waiting_element_is_visibility_on_the_page(
                            EditPageObject.LOCATOR_CHOOSE_OF_ENGINEER_PROJECT_TEAM)
                        choose_name_designer = self.find_element(EditPageObject.LOCATOR_CHOOSE_OF_ENGINEER_PROJECT_TEAM)
                        choose_name_designer.click()

    def object_profile_selection(self):
        """Выбор профиля"""
        with allure.step(f'Выбор профиля объекта'):
            with allure.step(f'Клик на профиль объекта'):
                object_profile = self.find_element(EditPageObject.LOCATOR_OBJECT_PROFILE_SELECTION)
                object_profile.click()
                with allure.step(f'Выбор профиля объекта Жилая недвижимость в выпавшем списке'):
                    self.waiting_element_is_visibility_on_the_page(
                        EditPageObject.LOCATOR_CHOOSE_OBJECT_PROFILE_SELECTION)
                    choose_object_profile = self.find_element(EditPageObject.LOCATOR_CHOOSE_OBJECT_PROFILE_SELECTION)
                    choose_object_profile.click()

    def choose_market(self):
        """Выбор Рынка"""
        with allure.step(f'Выбор Рынка объекта'):
            with allure.step(f'Клик на Рынок'):
                choose_market = self.find_element(EditPageObject.LOCATOR_MARKET_SELECTION)
                choose_market.click()
                with allure.step(f'Выбор профиля объекта: Новое стороительсво в выпавшем списке'):
                    self.waiting_element_is_visibility_on_the_page(EditPageObject.LOCATOR_CHOOSE_MARKET)
                    choose_object_profile_new = self.find_element(EditPageObject.LOCATOR_CHOOSE_MARKET)
                    choose_object_profile_new.click()

    def choose_study(self):
        """Выбор Стадии"""
        with allure.step(f'Выбор Стадии объекта'):
            with allure.step(f'Клик на поле стадии Объекта'):
                self.waiting_element_is_visibility_on_the_page(EditPageObject.LOCATOR_SELECT_STADY, sec=10)
                choose_study = self.find_element(EditPageObject.LOCATOR_SELECT_STADY)
                choose_study.click()
                with allure.step(f'Выбор стадии объекта из выпавшего списка'):
                    self.waiting_element_is_visibility_on_the_page(EditPageObject.LOCATOR_CHOOSE_STADY)
                    choose_study_new = self.find_element(EditPageObject.LOCATOR_CHOOSE_STADY)
                    choose_study_new.click()

    def input_field_note(self, text_note):
        """Ввод комменрия в поле Коментарий"""
        with allure.step(f'Ввод комментария в поле Комментарии'):
            field_note = self.find_element(EditPageObject.LOCATOR_FIELD_NOTE)
            field_note.click()
            field_note.send_keys(text_note)

    def save_edit_object(self):
        """Сохранение объекта"""
        with allure.step(f'Нажать на кнопку Сохранить объект'):
            save_object = self.find_element(EditPageObject.LOCATOR_BUTTON_SAVE_OBJECT_HEADER)
            self.driver.execute_script("arguments[0].click()", save_object)
            self.expecting_clickability(ObjectsPageLocators.LOCATOR_CHAPTER_KP)


@allure.feature('Модалка для ввода и выбора адреса')
class EditAddressInputPage(BasePage):
    """Модалка для ввода и выбора адреса"""

    def address_input(self, address):
        """Ввод и выбор адреса из выпадающего списка"""
        with allure.step(f'Ввод и выбор адреса из выпадающего списка'):
            with allure.step(f'Ввод адреса в поле выбора адреса'):
                address_input = self.find_element(EditAdressInput.LOCATOR_ADDRESS_INPUT)
                address_input.click()
                address_input.send_keys(address)
                with allure.step(f'Выбор адреса из списка'):
                    self.waiting_element_is_visibility_on_the_page(EditAdressInput.LOCATOR_ADDRESS_CHOISE)
                    address_choose = self.find_element(EditAdressInput.LOCATOR_ADDRESS_CHOISE)
                    self.driver.execute_script("arguments[0].click()", address_choose)
                    time.sleep(1)
                    with allure.step(f'Сохранение адреса'):
                        save_button_address = self.find_element(EditAdressInput.LOCATOR_BUTTON_SAVE_ADDRESS)
                        self.driver.execute_script("arguments[0].click()", save_button_address)
