import allure
import pytest

from config import TestEnvironment
from open_pages.cart_page.cart_page import CartPage
from open_pages.main_page.main_page import MainPage
from open_pages.selection_online_tools_all.selection_of_analogue_ridan_page.selection_of_analogue_ridan_page import \
    SelectionOfAnalogueRidanPage


def selection_of_analogue_ridan_equipment_by_article_number(browser, link_open: str,
                                                            link_selection_of_an_analogue_of_ridan: str, article: str,
                                                            login: str, password: str):
    """Подбор аналога оборудования Ридан - по артикулу"""

    page = MainPage(browser, link_open)
    page.open()
    page.authorization_from_main_page(login, password)

    page = SelectionOfAnalogueRidanPage(browser, link_selection_of_an_analogue_of_ridan)
    page.open()
    page.click_btn_search_by_article()
    page.article_entry_in_field_search_by_article(article)
    page.click_btn_search_in_by_article_search()
    article_analog = page.saving_analogue_article_as_a_link()
    page.click_btn_add_to_cart_in_card_analog()
    article_in_modal_add_to_cart = page.save_article_in_modal_add_to_cart()
    assert article_in_modal_add_to_cart == article_analog, \
        f'Артикул в модалке добавления в корзину - ({article_in_modal_add_to_cart}) не соответствует ' \
        f'артикулу в карточке аналога, который добавляли - ({article_analog})'
    page.click_btn_add_to_cart_in_modal_select_quantity_of_products()
    page.click_btn_go_to_cart_in_modal_items_added_to_cart()

    page = CartPage(browser, link_open)
    article_cart_page = page.save_list_articles_in_cart()
    assert article_in_modal_add_to_cart in article_cart_page, \
        f'Добавляемый артикул со страницы подбора аналога - ({article_in_modal_add_to_cart}) не соответствует ' \
        f'артикулу на странице Корзина - ({article_cart_page})'
    page.click_empty_trash()


@pytest.mark.xdist_group(name="open")
@allure.feature('Опеновские тесты')
@allure.story('Подбор аналога оборудования Ридан - по артикулу')
@pytest.mark.stage
@pytest.mark.parametrize('link_open', [TestEnvironment.LINK_OPEN_TST])
@pytest.mark.parametrize('link_selection_of_an_analogue_of_ridan',
                         ['https://ruecom-open-tst1.ridancorp.net/search/analogs'])
@pytest.mark.parametrize('article', ['013G7090'])
@pytest.mark.parametrize('login', [TestEnvironment.LOGIN_TST_VODOKOMFORT])
@pytest.mark.parametrize('password', [TestEnvironment.PASSWORD_TST_VODOKOMFORT])
def test_39752_selection_of_analogue_ridan_equipment_by_article_number_tst(browser, link_open,
                                                                           link_selection_of_an_analogue_of_ridan,
                                                                           article, login,
                                                                           password):
    """Подбор аналога оборудования Ридан - по артикулу"""
    selection_of_analogue_ridan_equipment_by_article_number(browser, link_open, link_selection_of_an_analogue_of_ridan,
                                                            article, login, password)
