import allure
import pytest

from open_pages.main_page.main_page import MainPage
from config import ProdEnvironment
from open_pages.header.header_page import Header
from open_pages.selection_online_tools_all.btp_selection.btp_selection_page import BTPPage
from open_pages.selection_tools_modal.selection_tools_modal import SelectionToolsModalPage


@allure.feature('Опеновские тесты')
@allure.story('Подбор БТП')
@pytest.mark.prod
def test_btp_configurator(browser):
    """Подбор БТП"""
    # Действия на Главной странице
    page = MainPage(browser, ProdEnvironment.OPEN_URL)
    page.open()
    page.authorization_from_main_page(ProdEnvironment.EMAIL_OPEN_PROD, ProdEnvironment.PASSWORD_OPEN_PROD)

    # Переход в модалку Инструменты подбора
    page = Header(browser, ProdEnvironment.OPEN_URL)
    page.go_to_option_tools()

    # Переход на страницу подбора БТП
    page = SelectionToolsModalPage(browser, ProdEnvironment.OPEN_URL)
    page.go_to_btp_select()

    # Выбор региона
    page = BTPPage(browser, ProdEnvironment.OPEN_URL)
    page.choice_region()

    # Заполнение данных модуль узла ввода
    value_pressure_one = '8'
    value_pressure_two = '6'
    page.input_node_module(value_pressure_one, value_pressure_two)
    page.page_return()

    # Заполнение данных модуль системы отопления
    value_thermal_power = '100'
    value_pressure_losses = '15'
    page.input_heating_system_module(value_thermal_power, value_pressure_losses)
    page.page_return()

    # Заполнение данных модуль системы ГВС
    value_thermal_power_dhw = '200'
    value_cold_water_pressure = '5'
    value_pressure_losses_dhw = '5'
    page.input_dhw_system_module(value_thermal_power_dhw, value_cold_water_pressure, value_pressure_losses_dhw)
    page.page_return()

    # Произвести расчет
    page.result_btp()

    # Отправка результатов на почту
    value_email = 'elka-ff@yandex.ru'
    value_address = 'Красногоск, Ильинское шоссе'
    page.sent_result_btp(value_email, value_address)
