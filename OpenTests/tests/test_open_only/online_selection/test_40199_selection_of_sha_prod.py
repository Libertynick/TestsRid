import allure
import pytest

from config import ProdEnvironment
from open_pages.header.header_page import Header
from open_pages.main_page.main_page import MainPage
from open_pages.selection_online_tools_all.sha_select_panel_config.selection_of_automation_cabinets_page import \
    ShaSelectPage, ShaManagedSystems
from open_pages.selection_tools_modal.selection_tools_modal import SelectionToolsModalPage


@allure.feature('Опеновские тесты')
@allure.story('Подбор ША (шкафы автоматизации) '
              'Тест выполняется только на продакшене, так как на тст нет данного функционала устоявшегося')
@pytest.mark.prod
def test_40199_selection_od_sha_prod(browser):
    """Подбор ША (шкафы автоматизации)
        Тест выполняется только на продакшене, так как на тст нет данного функционала устоявшегося
        """
    link_open = ProdEnvironment.OPEN_URL
    value_region = 'Moscow'
    address_object = 'ул Римского-Корсакова, д 1'
    name_system = 'Система отопления 1'
    count_pump = '1'

    producer = 'IMP'  # Производитель насоса
    choose_type = 'GHNbasic'  # Тип насоса
    choose_mark = 'GHNbasic_II_50_120F'  # Марка

    page = MainPage(browser, link_open)
    page.open()
    page.authorization_from_main_page(ProdEnvironment.EMAIL_OPEN_PROD, ProdEnvironment.PASSWORD_OPEN_PROD)

    page = Header(browser, link_open)
    page.go_to_option_tools()

    page = SelectionToolsModalPage(browser, link_open)
    page.click_tab_controllers()
    page.go_to_sha_select()
    page = ShaSelectPage(browser, link_open)
    page.click_btn_go_to_configurator()
    # Добавление информации во влкадке Регион и тип расчета
    page.choose_region(value_region)
    page.input_address_object(address_object)
    page.btn_further(address_object, value_region)
    # Заполнение информации во вкладке Управляемые системы
    page = ShaManagedSystems(browser, link_open)
    page.plus_one_heating_system()
    page.input_name_system_heating(name_system)
    page.input_count_pump(count_pump)
    page.input_producer_pump(producer)
    page.input_type_pump(choose_type)
    page.input_mark_pump(choose_mark)
    # page.input_external_frequency_converters_on_pumps()
    page.click_btn_next_manager_system()
    page.click_btn_next_schema_editing()
    page.click_btn_get_result()
    # Скачивание документации
    page.click_btn_download_pdf_spec()
    page.click_btn_download_dxf_spec()
    page.click_btn_download_pdf_kp()
