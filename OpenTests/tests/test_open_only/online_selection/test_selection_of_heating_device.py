import allure
import pytest
from open_pages.main_page.main_page import MainPage
from config import ProdEnvironment
from open_pages.header.header_page import Header
from open_pages.selection_online_tools_all.selection_of_heating_device.selection_of_heating_device_page import \
    HeatingDevice
from open_pages.selection_tools_modal.selection_tools_modal import SelectionToolsModalPage, HeatingAndHeatSupplyChapter


@allure.feature('Опеновские тесты')
@allure.story('Подбор мощности отопительного прибора')
@pytest.mark.prod
def test_selection_heating_device(browser):
    """Подбор мощности отопительного прибора"""
    # Действия на Главной странице
    page = MainPage(browser, ProdEnvironment.OPEN_URL)
    page.open()
    page.authorization_from_main_page(ProdEnvironment.EMAIL_OPEN_PROD, ProdEnvironment.PASSWORD_OPEN_PROD)

    # Переход  в модалку Инструменты подбора
    page = Header(browser, ProdEnvironment.OPEN_URL)
    page.go_to_option_tools()

    # Переход на страницу подбора мощности отопительного прибора
    page = SelectionToolsModalPage(browser, ProdEnvironment.OPEN_URL)
    page.click_tab_heating_and_heat_supply()

    page = HeatingAndHeatSupplyChapter(browser, ProdEnvironment.OPEN_URL)
    page.go_to_chapter_calculation_of_heating_device_power()
    page.click_btn_go_to_calculator_in_chapter_calculation_of_heating_device_power()

    # page.click_btn_go_to_dcad()

    # Ввод данных для подбора
    page = HeatingDevice(browser, ProdEnvironment.OPEN_URL)
    value_temp_supply = 90
    page.type_temp_the_supply_coolant(value_temp_supply)

    value_temp_return = 70
    page.type_temp_return_coolant(value_temp_return)

    value_inside_temp = 20
    page.type_inside_temp(value_inside_temp)
    page.choice_manufacturer()
    page.choice_model()
    page.choice_type()
    page.choice_height()
    page.choice_size()

    all_cookies = page.get_cookie_session()
    answer_kaptcha = page.captcha_solution_in_tst(all_cookies)
    print(answer_kaptcha)
