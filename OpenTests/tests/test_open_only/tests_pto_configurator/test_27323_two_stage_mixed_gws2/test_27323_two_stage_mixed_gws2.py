import allure
import pytest

from config import TestEnvironment
from open_pages.calculations_of_ol_and_pto_page.calculations_of_ol_and_pto import CalculationsOfOlAndPtoPage
from open_pages.main_page.main_page import MainPage
from open_pages.pto_configurator_page.standard_pto_calculation_page import StandardPtoPage
from open_pages.pto_configurator_page.two_stage_mixed_gws_2 import TwoStageMixedGws2, ModalSaveCalculation


def two_stage_mixed_gws2(browser, url: str, link_pto_configurator: str, login: str, password: str,
                         inn_company='7705238125'):
    """Двухступенчатая смешанная схема ГВС2"""

    value_heating_water_supply_temperature_summer = '130'  # Температура подающей теплосетевой воды Лето
    value_heating_water_supply_temperature_winter = '70'  # Температура подающей теплосетевой воды Зима

    value_heating_water_return_temperature_summer = '70'  # Температура обратной теплосетевой воды Лето
    value_heating_water_return_temperature_winter = '40'  # Температура обратной теплосетевой воды Зима

    value_heating_system_power = '2500'  # Мощность системы отопления
    value_cold_water_temperature = '5'  # Температура холодной воды
    value_hot_water_temperature = '65'  # Температура нагретой воды
    gws_system_power = '1'  # Мощность системы ГВС

    page = MainPage(browser, url)
    page.open()
    page.authorization_from_main_page(login, password)

    page = StandardPtoPage(browser, link_pto_configurator)
    page.open()
    page.go_to_two_stage_mixed_gws_2()

    #  Двухступенчатая смешанная схема ГВС2
    page = TwoStageMixedGws2(browser, url)
    page.there_should_be_a_default_value_in_field_return_heating_water_temperature_co()
    page.checking_the_default_value_in_the_heating_side_loss_field()
    page.checking_the_default_value_in_the_heated_side_loss_field()
    page.checking_default_value_in_surface_contamination_margin_field()
    page.checking_inclusion_of_radio_button_automatically_split_loads_of_gws_system()
    page.checking_selection_in_calculation_scheme_field_of_check_box_monoblock()
    page.switch_to_advanced_selection()
    page.checking_radio_button_selection_include_mating_flanges_sleeves_in_price()
    page.checking_radio_button_selection_allow_program_to_change_initial_data()

    # Заполнение полей
    page.input_heating_water_supply_temperature_summer(value_heating_water_supply_temperature_summer)
    page.input_heating_water_supply_temperature_winter(value_heating_water_supply_temperature_winter)
    page.input_return_heating_water_temperature_summer(value_heating_water_return_temperature_summer)
    page.input_return_heating_water_temperature_winter(value_heating_water_return_temperature_winter)
    page.input_heating_system_power(value_heating_system_power)
    page.entering_cold_water_temperature(value_cold_water_temperature)
    page.choice_unit_of_measurement_heating_system_output_kwt()
    page.input_dhw_heated_water_temperature_tz(value_hot_water_temperature)
    page.input_of_gws_system_power(gws_system_power)
    page.click_on_the_select_button()
    page.checking_the_opening_of_calculation_details()
    page.click_button_verification_calculation()
    page.switching_window(0)
    page.checking_the_check_box_and_choosing_a_solution()
    page.click_on_button_to_save_calculation_for_the_selected_products()

    # Модалка Сохранить расчет
    page = ModalSaveCalculation(browser, url)
    page.input_name_object()
    page.input_description_for_calculation()
    page.click_button_save()
    num_calculation = page.saving_the_calculation_number()
    print(num_calculation, 'Номер расчета')
    page.click_button_calculation_of_ol_and_pto()

    #  Страница Расчеты ОЛ и ПТО
    page = CalculationsOfOlAndPtoPage(browser, url)
    page.click_advanced_search()
    page.type_num_calc_in_search(num_calculation)
    page.click_button_search(num_calculation)


@allure.feature('Опеновские тесты')
@allure.story('Двухступенчатая смешанная схема ГВС2')
@pytest.mark.stage
def test_27323_two_stage_mixed_gws2_tst(browser):
    link_pto_configurator = 'https://ruecom-open-tst1.ridancorp.net/instruments/configurator-pto/standard'
    url_tst = TestEnvironment.LINK_OPEN_TST
    login_tst = TestEnvironment.LOGIN_TST_VODOKOMFORT
    password_tst = TestEnvironment.PASSWORD_TST_VODOKOMFORT

    two_stage_mixed_gws2(browser, url_tst, link_pto_configurator, login_tst, password_tst)
