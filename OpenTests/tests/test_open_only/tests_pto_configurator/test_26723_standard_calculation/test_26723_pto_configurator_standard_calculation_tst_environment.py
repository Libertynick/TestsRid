import allure
import pytest

from config import TestEnvironment
from open_pages.calculations_of_ol_and_pto_page.calculations_of_ol_and_pto import CalculationsOfOlAndPtoPage
from open_pages.main_page.main_page import MainPage
from open_pages.pto_configurator_page.standard_pto_calculation_page import StandardPtoPage


def pto_configurator_standard_calculation(browser, url: str, link_pto_configurator: str, login: str, password: str,
                                          inn_company='7705238125'):
    """Конфигуратор ПТО Стандартный расчёт
    inn_company- ИНН компании """
    # Авторизация

    page = MainPage(browser, url)
    page.open()
    page.authorization_from_main_page(login, password)

    # Стандартный расчет
    page = StandardPtoPage(browser, link_pto_configurator)
    page.open()
    page.click_btn_standard_mode()

    value_power = '1'
    page.type_power(value_power)
    value = '80'
    page.type_hot_water_in(value)
    value = '30'
    page.type_cold_water_in(value)
    value = '50'
    page.type_hot_water_from(value)
    value = '40'
    page.type_cold_water_from(value)
    page.click_pick_pto()
    page.should_be_solution_details()
    page.click_save_solution()
    name = 'ТЕСТИРОВАНИЕ'
    description = 'ТЕСТИРОВАНИЕ!!!'
    page.type_form_save_solution(name, description)
    page.click_save_calculation_in_modal()
    num_calc = page.save_num_calculation()
    print(num_calc)
    page.click_calculations_of_ol_and_pto()

    # Страница Расчеты и ОЛ ПТО
    page = CalculationsOfOlAndPtoPage(browser, url)
    page.click_advanced_search()
    page.choice_of_inn(inn_company)
    page.type_num_calc_in_search(num_calc)
    page.click_button_search(num_calc)


@allure.feature('Опеновские тесты')
@allure.story('Конфигуратор ПТО Стандартный расчёт')
@pytest.mark.stage
def test_pto_configurator_standard_calculation_for_tst_environment(browser):
    url_tst = TestEnvironment.LINK_OPEN_TST
    login_tst = TestEnvironment.LOGIN_TST_VODOKOMFORT
    password_tst = TestEnvironment.PASSWORD_TST_VODOKOMFORT
    link_tst_standard_calculation_of_pto = TestEnvironment.LINK_TST_STANDARD_CALCULATION_OF_PTO
    link_pto_configurator = link_tst_standard_calculation_of_pto

    pto_configurator_standard_calculation(browser, url_tst, link_pto_configurator, login_tst, password_tst)
