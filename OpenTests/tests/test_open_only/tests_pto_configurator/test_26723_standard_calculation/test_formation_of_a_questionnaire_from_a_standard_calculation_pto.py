import allure
import pytest

from config import TestEnvironment
from open_pages.calculations_of_ol_and_pto_page.calculations_of_ol_and_pto import CalculationsOfOlAndPtoPage
from open_pages.main_page.main_page import MainPage
from open_pages.pto_configurator_page.standard_pto_calculation_page import StandardPtoPage


def formation_of_a_questionnaire_from_a_standard_calculation_pto(browser, url: str, link_pto_configurator: str,
                                                                 login: str, password: str,
                                                                 inn_company='7705238125'):
    """Формирование опросного листа из стандартного расчета конфигуратора ПТО"""
    # Авторизация

    page = MainPage(browser, url)
    page.open()
    page.authorization_from_main_page(login, password)

    # Стандартный расчет
    page = StandardPtoPage(browser, link_pto_configurator)
    page.open()
    page.click_btn_standard_mode()
    # page.should_be_heat_supply()
    value_power = '1'
    page.type_power(value_power)
    value = '80'
    page.type_hot_water_in(value)
    value = '30'
    page.type_cold_water_in(value)
    value = '50'
    page.type_hot_water_from(value)
    value = '40'
    page.type_cold_water_from(value)
    page.click_button_generate_a_questionnaire()
    page.entering_a_comment_in_the_questionnaire_description_field()
    page.click_button_send_to_billing_department()
    page.click_button_send_to_billing_department()
    questionnaire_number = page.saving_the_number_of_the_questionnaire_from_the_modal_window()
    print(questionnaire_number, 'Номер опросного листа')
    page.click_calculations_of_ol_and_pto()

    # Страница Расчеты и ОЛ ПТО
    page = CalculationsOfOlAndPtoPage(browser, TestEnvironment.LINK_OPEN_TST)
    page.click_advanced_search()
    page.choice_of_inn(inn_company)
    page.type_num_calc_in_search(questionnaire_number)
    page.click_button_search(questionnaire_number)
    page.downloading_the_questionnaire(questionnaire_number)


@allure.feature('Опеновские тесты')
@allure.story('Формирование опросного листа из стандартного расчета конфигуратора ПТО')
@pytest.mark.stage
def test_formation_of_a_questionnaire_from_a_standard_calculation_pto(browser):
    url_tst = TestEnvironment.LINK_OPEN_TST
    login_tst = TestEnvironment.LOGIN_TST_VODOKOMFORT
    password_tst = TestEnvironment.PASSWORD_TST_VODOKOMFORT
    link_pto_configurator = 'https://ruecom-open-tst1.ridancorp.net/instruments/configurator-pto/standard'

    formation_of_a_questionnaire_from_a_standard_calculation_pto(browser, url_tst, link_pto_configurator,
                                                                 login_tst, password_tst)
