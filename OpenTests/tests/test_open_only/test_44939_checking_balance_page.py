import allure
import pytest
from selenium.common import TimeoutException

from config import TestEnvironment
from open_pages.balance_page.balance_page import BalancePage
from open_pages.header.profile_menu_user import ProfileMenuUser
from open_pages.main_page.main_page import MainPage


@allure.feature('Опеновские тесты')
@allure.story('Проверка страницы Баланс')
@pytest.mark.stage
def test_44939_checking_balance_page(browser):
    """Проверка страницы Баланс"""
    link_open_tst = TestEnvironment.LINK_OPEN_TST
    login_open_tst = TestEnvironment.LOGIN_TST_ELITA
    password_open_tst = TestEnvironment.PASSWORD_TST_ELITA
    num_inn = '7810955675'
    salesman = 'ООО "РИДАН ТРЕЙД"'
    period_of_reconciliation_report_date_from = '01.03.24'  # Период акта сверки - дата с
    period_of_reconciliation_report_date_to = '31.03.24'  # Период акта сверки - дата до

    page = MainPage(browser, link_open_tst)
    page.open()
    page.authorization_from_main_page(login_open_tst, password_open_tst)

    page = ProfileMenuUser(browser, link_open_tst)
    page.go_to_balance()

    page = BalancePage(browser, link_open_tst)
    page.choice_of_inn(num_inn)
    page.checking_selected_default_salesman(salesman)
    page.balance_including_advance_payment_should_not_be_empty_or_zero()
    page.advance_payment_must_not_be_empty_or_zero()
    page.debt_must_not_be_empty_or_zero()
    page.filling_out_period_of_reconciliation_report(
        period_of_reconciliation_report_date_from, period_of_reconciliation_report_date_to)

    page.click_btn_upload_reconciliation_report(
        period_of_reconciliation_report_date_from, period_of_reconciliation_report_date_to, num_inn)

    page.checking_that_at_least_one_column_in_column_number_and_date_upd_is_complete()
    try:
        page.checking_functionality_of_link_to_an_order_that_is_not_overdue()
    except TimeoutException as e:
        print(f'На странице баланса нет рабочей ссылки на непросроченный заказ - проблема с тестовыми данными.'
              f'Ошибка - {e}')
