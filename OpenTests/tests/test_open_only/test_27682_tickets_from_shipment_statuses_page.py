from base_page.base_page import BasePageCrm
from config import TestEnvironment
from open_pages.header.profile_menu_user import ProfileMenuUser
from open_pages.main_page.main_page import MainPage
from open_pages.order_list_page.order_list_page import OrderList
from open_pages.shipment_statuses_page.shipments_page import ShipmentInStock, ModalTermsOfShipment
from tms_pages.customer_service_pages.tickets_page.tickets_page import TicketsPage


def tickets_from_shipment_statuses_page_27682(browser, num_order: str):
    """ 27682 Тикеты со страницы Статусы отгрузок"""
    delivery_method = "Доставка на указанный адрес"
    delivery_address = 'г Иваново, ул Кузнецова, д 123'

    page = MainPage(browser, TestEnvironment.LINK_OPEN_TST)
    page.open()
    page.authorization_from_main_page(TestEnvironment.LOGIN_TST_VODOKOMFORT, TestEnvironment.PASSWORD_TST_VODOKOMFORT)
    page = ProfileMenuUser(browser, TestEnvironment.LINK_OPEN_TST)
    page.go_to_orders_menu_distributor()

    # Поиск заказа и переход в него для обновления статуса в позициях
    page = OrderList(browser, TestEnvironment.LINK_OPEN_TST)
    page.order_search_by_number_and_author(num_order)
    page.go_to_order(num_order)

    # Переход на странице Статусы отгрузок
    page = ProfileMenuUser(browser, TestEnvironment.LINK_OPEN_TST)
    page.go_to_shipments()

    page = ShipmentInStock(browser, TestEnvironment.LINK_OPEN_TST)
    page.search_order(num_order)
    page.select_checkbox_to_request_shipment_of_entire_order()
    page.click_button_request_shipment()

    # Модалка Условия отгрузки
    page = ModalTermsOfShipment(browser, TestEnvironment.LINK_OPEN_TST)
    page.choosing_a_delivery_method(delivery_method)
    page.entering_delivery_address(delivery_address)
    page.click_button_calculate_delivery_costs()
    page.click_button_send_request()
    page.status_must_be_sent_to_customer_service_in_json()
    ticket_number = page.saving_ticket_number()
    print(ticket_number, 'Номер тикета при запросе отгрузки')

    # Переход в кл. сервис для проверки создания заявки
    page = BasePageCrm(browser, TestEnvironment.LINK_TICKETS_TMS_TST)
    page.authentication_crm(TestEnvironment.LINK_TICKETS_TMS_TST, TestEnvironment.LOGIN_CRM,
                            TestEnvironment.PASSWORD_CRM_TST)

    page = TicketsPage(browser, TestEnvironment.LINK_TICKETS_TMS_TST)
    page.search_shipment_request_by_num_order(num_order, ticket_number)

# def test_27682_tickets_from_shipment_statuses_page(browser):
#     num_order = 'RT23-076898'
#     tickets_from_shipment_statuses_page_27682(browser, num_order)
