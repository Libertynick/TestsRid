import os
from pathlib import Path

import allure
import pytest

from config import TestEnvironment
from open_pages.main_page.main_page import MainPage
from open_pages.selection_online_tools_all.clever_desk.clever_desk_page import CleverDeskPage


@pytest.mark.xfail(reason='Не обрабатывается файл.')
@allure.feature('Опеновские тесты')
@allure.story('Обработка файла с помощью CleverDesk в Опен')
@pytest.mark.stage
def test_clever_desk_open(browser):
    """Обработка файла с помощью CleverDesk в Опен"""
    link_open = TestEnvironment.LINK_OPEN_TST
    link_clever_desc = 'https://ruecom-open-tst1.ridancorp.net/cleverdesk'
    document = str(Path.cwd() / "files_to_upload_to_page/Для_CleverDesk - 2 (ТП).pdf")
    current_path_to_document = os.path.realpath(document)
    field_start = '1'
    field_end = '3'

    # Действия на Главной странице
    page = MainPage(browser, link_open)
    page.open()
    page.authorization_from_main_page(TestEnvironment.LOGIN_TST_VODOKOMFORT, TestEnvironment.PASSWORD_TST_VODOKOMFORT)

    # Работа на странице Clever Desk
    page = CleverDeskPage(browser, link_clever_desc)
    page.open()
    page.click_btn_online_configurator()
    page.add_specification(current_path_to_document)
    page.choose_selection()

    page.input_start_page(field_start)
    page.input_end_page(field_end)
    page.click_btn_replacement()
    page.click_btn_result_spec()
