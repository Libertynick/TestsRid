from datetime import datetime

import requests
import pytest


@pytest.mark.monitoring
def assert_link():
    link = 'https://ridan.ru/product/'

    name_file = 'result_test_assert_link' + str(datetime.now().strftime("%d_%b_%Y_%H_%M_%S_GMT")) + '.txt'
    with open("tests/assert_link/codes_for_link.txt", "r") as file:
        codes_list = [line.strip() for line in file if not line.isspace()]

    for el in codes_list:
        print(el)
        link_product = link + str(el)
        print(link_product)
        r = requests.get(link_product)
        status_code = r.status_code
        print(status_code)
        if status_code != 200:
            print(status_code, 'status code', link_product)
            with open('results/result_test_assert_link/' + name_file, 'a') as file:
                file.write(f'{status_code} - код ответа. Ссылка - {link_product}\n')
